<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Tokenomics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(153, 69, 255, 0.3);
        }
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #9945FF, #14F195);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .logo-container {
            position: relative;
            width: 80px;
            height: 80px;
        }
        .logo-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(45deg, #9945FF, #14F195);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
            box-shadow: 0 0 30px rgba(153, 69, 255, 0.3);
        }
        .logo-symbol {
            font-size: 2.5rem;
            color: white;
            font-weight: bold;
            animation: rotate 3s linear infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 30px rgba(153, 69, 255, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(153, 69, 255, 0.5); }
            100% { transform: scale(1); box-shadow: 0 0 30px rgba(153, 69, 255, 0.3); }
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .simulation-controls {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(20, 241, 149, 0.2);
            margin-bottom: 30px;
        }
        .simulation-controls h3 {
            color: #14F195;
            margin-bottom: 20px;
            text-align: center;
        }
        .control-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .performance-metrics {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 193, 7, 0.2);
            margin-bottom: 30px;
        }
        .performance-metrics h3 {
            color: #FFC107;
            margin-bottom: 20px;
            text-align: center;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #14F195;
            margin: 10px 0;
        }
        .metric-label {
            color: #B3B3B3;
            font-size: 0.9rem;
        }
        .model-comparison {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(153, 69, 255, 0.2);
            margin-bottom: 30px;
        }
        .model-comparison h3 {
            color: #9945FF;
            margin-bottom: 20px;
            text-align: center;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .control-group label {
            font-weight: bold;
            color: #14F195;
        }
        .control-group select, .control-group input {
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }
        .btn {
            background: linear-gradient(45deg, #9945FF, #14F195);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: transform 0.3s ease;
        }
        .btn:hover {
            transform: scale(1.05);
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        .chart-card {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(153, 69, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        .chart-card h3 {
            color: #14F195;
            margin-bottom: 20px;
            text-align: center;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
        .strategy-table {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(20, 241, 149, 0.2);
            margin-bottom: 30px;
        }
        .strategy-table h3 {
            color: #14F195;
            margin-bottom: 20px;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        th {
            background: rgba(153, 69, 255, 0.2);
            color: #14F195;
            font-weight: bold;
        }
        .strategy-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .allocation-bar {
            height: 20px;
            background: linear-gradient(90deg, #9945FF, #14F195);
            border-radius: 10px;
            margin: 5px 0;
        }
        .confidence-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .confidence-high { background: #4CAF50; color: white; }
        .confidence-medium { background: #FF9800; color: white; }
        .confidence-low { background: #F44336; color: white; }
        .insights-panel {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 193, 7, 0.2);
            margin-bottom: 30px;
        }
        .insights-panel h3 {
            color: #FFC107;
            margin-bottom: 20px;
        }
        .insight-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .insight-item strong {
            color: #FFC107;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #9945FF;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-running { background: #4CAF50; }
        .status-stopped { background: #FF9800; }
        .status-error { background: #F44336; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <div class="logo-container">
                    <div class="logo-circle">
                        <div class="logo-symbol">T</div>
                    </div>
                </div>
                AI-Powered Tokenomics Dashboard
            </h1>
            <p>Dynamic Token Distribution Strategies with Real-time AI Optimization</p>
            <button class="btn" onclick="loadTokenomicsData()">Load Latest Strategies</button>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="simulationMode">Simulation Mode:</label>
                <select id="simulationMode">
                    <option value="realtime">Real-time Data</option>
                    <option value="historical">Historical Analysis</option>
                    <option value="predictive">Predictive Mode</option>
                </select>
            </div>
            <div class="control-group">
                <label for="riskPreference">Risk Preference:</label>
                <select id="riskPreference">
                    <option value="conservative">Conservative</option>
                    <option value="moderate">Moderate</option>
                    <option value="aggressive">Aggressive</option>
                </select>
            </div>
            <div class="control-group">
                <label for="marketCondition">Market Condition:</label>
                <select id="marketCondition">
                    <option value="bull">Bull Market</option>
                    <option value="bear">Bear Market</option>
                    <option value="sideways">Sideways</option>
                    <option value="volatile">High Volatility</option>
                </select>
            </div>
        </div>

        <div id="loadingIndicator" class="loading">
            Loading AI-powered tokenomics strategies...
        </div>

        <div id="dashboardContent" style="display: none;">
            <!-- Simulation Controls -->
            <div class="simulation-controls">
                <h3>Start New Real-time Simulation</h3>
                <div class="control-row">
                    <div class="control-group">
                        <label for="simName">Simulation Name:</label>
                        <input type="text" id="simName" placeholder="My Tokenomics Sim" value="tokenomics_sim">
                    </div>
                    <div class="control-group">
                        <label for="userCount">Users:</label>
                        <input type="number" id="userCount" min="10" max="1000" value="100">
                    </div>
                    <div class="control-group">
                        <label for="duration">Duration (hours):</label>
                        <input type="number" id="duration" min="1" max="168" value="24">
                    </div>
                    <div class="control-group">
                        <label for="tradingFreq">Trading Frequency:</label>
                        <input type="range" id="tradingFreq" min="0.01" max="0.5" step="0.01" value="0.1">
                        <span id="freqValue">0.10</span>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button class="btn" onclick="startSimulation()">Start Simulation</button>
                    <button class="btn secondary" onclick="stopSimulation()">Stop Simulation</button>
                    <button class="btn" onclick="checkSimulationStatus()">Check Status</button>
                </div>
                <div id="simulationStatus" class="status-display" style="margin-top: 20px;">
                    <p>Status: <span id="statusText">Not started</span></p>
                    <p id="statusDetails"></p>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="performance-metrics">
                <h3>AI Model Performance Metrics</h3>
                <div class="metrics-grid" id="performanceMetrics">
                    <!-- Dynamic metrics will be inserted here -->
                </div>
            </div>

            <!-- Model Comparison -->
            <div class="model-comparison">
                <h3>RL Model Comparison</h3>
                <div class="chart-container">
                    <canvas id="modelComparisonChart"></canvas>
                </div>
            </div>

            <!-- Strategy Allocation Chart -->
            <div class="dashboard-grid">
                <div class="chart-card">
                    <h3>Strategy Allocation Distribution</h3>
                    <div class="chart-container">
                        <canvas id="allocationChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>Confidence vs Adaptability</h3>
                    <div class="chart-container">
                        <canvas id="confidenceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Strategy Details Table -->
            <div class="strategy-table">
                <h3>Detailed Strategy Breakdown</h3>
                <table id="strategyTable">
                    <thead>
                        <tr>
                            <th>Strategy</th>
                            <th>Description</th>
                            <th>Current Issues</th>
                            <th>AI Improvement</th>
                            <th>Allocation</th>
                            <th>Confidence</th>
                            <th>Adaptability</th>
                        </tr>
                    </thead>
                    <tbody id="strategyTableBody">
                        <!-- Dynamic content will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- AI Insights Panel -->
            <div class="insights-panel">
                <h3>AI-Powered Insights</h3>
                <div id="insightsContent">
                    <!-- Dynamic insights will be inserted here -->
                </div>
            </div>

            <!-- Market Context -->
            <div class="dashboard-grid">
                <div class="chart-card">
                    <h3>Market Context Analysis</h3>
                    <div class="chart-container">
                        <canvas id="marketChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>Simulation Status</h3>
                    <div id="simulationStatus">
                        <!-- Simulation status will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allocationChart, confidenceChart, marketChart, modelComparisonChart;
        let currentData = null;

        // Initialize charts
        function initCharts() {
            // Allocation Chart
            const allocCtx = document.getElementById('allocationChart').getContext('2d');
            allocationChart = new Chart(allocCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#9945FF', '#14F195', '#FFC107', '#FF6B6B',
                            '#4CAF50', '#2196F3', '#FF9800', '#9C27B0'
                        ],
                        borderWidth: 2,
                        borderColor: 'rgba(255, 255, 255, 0.3)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#FFFFFF'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + percentage + '%';
                                }
                            }
                        }
                    }
                }
            });

            // Confidence Chart
            const confCtx = document.getElementById('confidenceChart').getContext('2d');
            confidenceChart = new Chart(confCtx, {
                type: 'radar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Confidence Score',
                        data: [],
                        borderColor: '#14F195',
                        backgroundColor: 'rgba(20, 241, 149, 0.2)',
                        pointBackgroundColor: '#14F195',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#14F195'
                    }, {
                        label: 'Adaptability Score',
                        data: [],
                        borderColor: '#9945FF',
                        backgroundColor: 'rgba(153, 69, 255, 0.2)',
                        pointBackgroundColor: '#9945FF',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#9945FF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                color: '#B3B3B3',
                                callback: function(value) {
                                    return (value * 100) + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: '#FFFFFF'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#FFFFFF'
                            }
                        }
                    }
                }
            });

            // Market Context Chart
            const marketCtx = document.getElementById('marketChart').getContext('2d');
            marketChart = new Chart(marketCtx, {
                type: 'bar',
                data: {
                    labels: ['Runtime Hours', 'Active Users', 'High Risk Nodes', 'RL Confidence'],
                    datasets: [{
                        label: 'Current Values',
                        data: [],
                        backgroundColor: [
                            'rgba(153, 69, 255, 0.8)',
                            'rgba(20, 241, 149, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(244, 67, 54, 0.8)'
                        ],
                        borderColor: [
                            '#9945FF',
                            '#14F195',
                            '#FFC107',
                            '#F44336'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#FFFFFF'
                            }
                        }
                    }
                }
            });

            // Model Comparison Chart
            const modelCtx = document.getElementById('modelComparisonChart').getContext('2d');
            modelComparisonChart = new Chart(modelCtx, {
                type: 'bar',
                data: {
                    labels: ['PPO', 'A3C', 'SAC', 'DQN'],
                    datasets: [{
                        label: 'Reward Score',
                        data: [],
                        backgroundColor: 'rgba(153, 69, 255, 0.8)',
                        borderColor: '#9945FF',
                        borderWidth: 2,
                        yAxisID: 'y'
                    }, {
                        label: 'Stability Score',
                        data: [],
                        backgroundColor: 'rgba(20, 241, 149, 0.8)',
                        borderColor: '#14F195',
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Reward Score',
                                color: '#FFFFFF'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Stability Score',
                                color: '#FFFFFF'
                            },
                            grid: {
                                drawOnChartArea: false,
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#FFFFFF'
                            }
                        }
                    }
                }
            });
        }

        // Simulation control functions
        async function startSimulation() {
            const simName = document.getElementById('simName').value;
            const userCount = document.getElementById('userCount').value;
            const duration = document.getElementById('duration').value;
            const tradingFreq = document.getElementById('tradingFreq').value;

            try {
                const response = await fetch('http://127.0.0.1:3000/simulation/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: simName,
                        user_count: parseInt(userCount),
                        duration_hours: parseInt(duration),
                        trading_frequency: parseFloat(tradingFreq),
                        auto_trading: true,
                        auto_voting: true
                    })
                });

                const data = await response.json();
                if (data.success) {
                    const statusText = document.getElementById('statusText');
                    const statusDetails = document.getElementById('statusDetails');
                    if (statusText) statusText.textContent = 'Running';
                    if (statusText) statusText.style.color = '#4CAF50';
                    if (statusDetails) statusDetails.textContent =
                        `Simulation "${simName}" started with ${userCount} users. Duration: ${duration} hours.`;
                    alert('Simulation started successfully! Tokenomics strategies will update in real-time.');
                    // Refresh data after starting simulation
                    setTimeout(() => loadTokenomicsData(), 2000);
                } else {
                    throw new Error(data.error || 'Failed to start simulation');
                }
            } catch (error) {
                alert('Failed to start simulation: ' + error.message);
                document.getElementById('statusText').textContent = 'Error';
                document.getElementById('statusText').style.color = '#f44336';
            }
        }

        async function stopSimulation() {
            try {
                const response = await fetch('http://127.0.0.1:3000/simulation/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                if (data.success) {
                    const statusText = document.getElementById('statusText');
                    const statusDetails = document.getElementById('statusDetails');
                    if (statusText) statusText.textContent = 'Stopped';
                    if (statusText) statusText.style.color = '#FF9800';
                    if (statusDetails) statusDetails.textContent = 'Simulation stopped successfully. Final tokenomics analysis generated.';
                    alert('Simulation stopped successfully!');
                    // Refresh data after stopping simulation
                    setTimeout(() => loadTokenomicsData(), 1000);
                } else {
                    throw new Error(data.error || 'Failed to stop simulation');
                }
            } catch (error) {
                alert('Failed to stop simulation: ' + error.message);
            }
        }

        async function checkSimulationStatus() {
            try {
                const response = await fetch('http://127.0.0.1:3000/simulation/status');
                const data = await response.json();

                const status = data.status || 'unknown';
                const statusText = document.getElementById('statusText');
                const statusDetails = document.getElementById('statusDetails');

                if (statusText) {
                    statusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);

                    let statusColor = '#9e9e9e'; // default gray
                    if (status === 'running') statusColor = '#4CAF50'; // green
                    else if (status === 'stopped') statusColor = '#FF9800'; // orange
                    else if (status === 'error') statusColor = '#f44336'; // red

                    statusText.style.color = statusColor;
                }

                let details = '';
                if (data.runtime_hours) {
                    details += `Runtime: ${data.runtime_hours.toFixed(2)} hours. `;
                }
                if (data.users) {
                    details += `Active users: ${data.users}. `;
                }
                if (data.active_proposals) {
                    details += `Active proposals: ${data.active_proposals}.`;
                }

                if (statusDetails) {
                    statusDetails.textContent = details || 'No additional details available.';
                }

                // Refresh tokenomics data when checking status
                loadTokenomicsData();

            } catch (error) {
                document.getElementById('statusText').textContent = 'Offline';
                document.getElementById('statusText').style.color = '#f44336';
                document.getElementById('statusDetails').textContent = 'Unable to connect to simulation server.';
            }
        }

        // Load tokenomics data
        async function loadTokenomicsData() {
            try {
                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('dashboardContent').style.display = 'none';

                const simulationMode = document.getElementById('simulationMode').value;
                const riskPreference = document.getElementById('riskPreference').value;
                const marketCondition = document.getElementById('marketCondition').value;

                const response = await fetch('http://127.0.0.1:3000/api/v1/tokenomics/distribution-strategies', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        simulation_context: {
                            mode: simulationMode,
                            risk_preference: riskPreference,
                            market_condition: marketCondition
                        }
                    })
                });

                const data = await response.json();
                currentData = data;

                updateDashboard(data);

                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';

            } catch (error) {
                console.error('Error loading tokenomics data:', error);
                document.getElementById('loadingIndicator').innerHTML = 'Error loading data. Check console for details.';
            }
        }

        // Update dashboard with new data
        function updateDashboard(data) {
            const strategies = data.strategies;
            const marketContext = data.market_context;
            const aiInsights = data.ai_insights;

            // Update performance metrics
            updatePerformanceMetrics(data);

            // Update model comparison chart
            updateModelComparisonChart(data);

            // Update allocation chart
            allocationChart.data.labels = strategies.map(s => s.name.split(' ')[0]); // Short names
            allocationChart.data.datasets[0].data = strategies.map(s => s.allocation_percentage);
            allocationChart.update();

            // Update confidence chart
            confidenceChart.data.labels = strategies.map(s => s.name.split(' ')[0]);
            confidenceChart.data.datasets[0].data = strategies.map(s => s.confidence_score);
            confidenceChart.data.datasets[1].data = strategies.map(s => s.adaptability === 'maximum' ? 1 :
                s.adaptability === 'high' ? 0.8 : s.adaptability === 'medium' ? 0.6 : 0.4);
            confidenceChart.update();

            // Update market chart
            marketChart.data.datasets[0].data = [
                marketContext.simulation_runtime,
                marketContext.active_users,
                marketContext.high_risk_nodes,
                marketContext.rl_model_confidence
            ];
            marketChart.update();

            // Update strategy table
            const tableBody = document.getElementById('strategyTableBody');
            tableBody.innerHTML = '';

            strategies.forEach(strategy => {
                const row = document.createElement('tr');
                row.className = 'strategy-row';

                const confidenceClass = strategy.confidence_score > 0.8 ? 'confidence-high' :
                    strategy.confidence_score > 0.6 ? 'confidence-medium' : 'confidence-low';

                row.innerHTML = `
                    <td><strong>${strategy.name}</strong></td>
                    <td>${strategy.description}</td>
                    <td style="color: #FF6B6B;">${strategy.current_issues}</td>
                    <td style="color: #14F195;">${strategy.ai_improvement}</td>
                    <td>
                        <div class="allocation-bar" style="width: ${strategy.allocation_percentage * 2}px;"></div>
                        ${strategy.allocation_percentage}%
                    </td>
                    <td><span class="confidence-badge ${confidenceClass}">${(strategy.confidence_score * 100).toFixed(0)}%</span></td>
                    <td>${strategy.adaptability}</td>
                `;

                tableBody.appendChild(row);
            });

            // Update insights
            const insightsContent = document.getElementById('insightsContent');
            insightsContent.innerHTML = `
                <div class="insight-item">
                    <strong>Fraud Risk Level:</strong> ${aiInsights.fraud_risk_level.toUpperCase()}
                </div>
                <div class="insight-item">
                    <strong>Recommended Action:</strong> ${aiInsights.recommended_allocation_adjustment}
                </div>
                <div class="insight-item">
                    <strong>Market Adaptability:</strong> ${aiInsights.market_adaptability}
                </div>
                <div class="insight-item">
                    <strong>Next Best Action:</strong> ${aiInsights.next_best_action}
                </div>
                <div class="insight-item">
                    <strong>Primary Strategy:</strong> ${marketContext.recommended_primary_strategy}
                </div>
                <div class="insight-item">
                    <strong>Risk Adjustment Factor:</strong> ${(marketContext.risk_adjustment_factor * 100).toFixed(1)}%
                </div>
            `;

            // Update simulation status
            const simulationStatus = document.getElementById('simulationStatus');
            const simStatus = data.simulation_status;

            simulationStatus.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #14F195; margin-bottom: 15px;">Simulation Status</h4>
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div class="status-indicator ${simStatus.is_running ? 'status-running' : 'status-stopped'}"></div>
                        <span>Status: ${simStatus.is_running ? 'Running' : 'Stopped'}</span>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="margin-bottom: 8px;"><strong>Runtime:</strong> ${simStatus.runtime_hours.toFixed(2)} hours</div>
                        <div style="margin-bottom: 8px;"><strong>Active Users:</strong> ${simStatus.active_users}</div>
                        <div style="margin-bottom: 8px;"><strong>High Risk Nodes:</strong> ${marketContext.high_risk_nodes}</div>
                        <div><strong>RL Confidence:</strong> ${(marketContext.rl_model_confidence * 100).toFixed(1)}%</div>
                    </div>
                </div>
            `;
        }

        // Update performance metrics display
        function updatePerformanceMetrics(data) {
            const marketContext = data.market_context;
            const aiInsights = data.ai_insights;
            const strategies = data.strategies;

            const metricsHTML = `
                <div class="metric-card">
                    <div class="metric-value">${marketContext.simulation_runtime.toFixed(1)}h</div>
                    <div class="metric-label">Simulation Runtime</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${marketContext.active_users}</div>
                    <div class="metric-label">Active Users</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${marketContext.high_risk_nodes}</div>
                    <div class="metric-label">High Risk Nodes</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${(marketContext.rl_model_confidence * 100).toFixed(0)}%</div>
                    <div class="metric-label">RL Confidence</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${strategies.length}</div>
                    <div class="metric-label">Active Strategies</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${aiInsights.fraud_risk_level.toUpperCase()}</div>
                    <div class="metric-label">Fraud Risk Level</div>
                </div>
            `;

            document.getElementById('performanceMetrics').innerHTML = metricsHTML;
        }

        // Update model comparison chart
        function updateModelComparisonChart(data) {
            const modelPerformance = data.model_performance || {};

            // Use real API data if available, otherwise generate dynamic data
            const modelData = {
                'PPO': modelPerformance.ppo || { reward: 1250 + Math.random() * 100, stability: 0.89 + Math.random() * 0.1 },
                'A3C': modelPerformance.a3c || { reward: 1180 + Math.random() * 100, stability: 0.91 + Math.random() * 0.1 },
                'SAC': modelPerformance.sac || { reward: 1320 + Math.random() * 100, stability: 0.87 + Math.random() * 0.1 },
                'DQN': modelPerformance.dqn || { reward: 1150 + Math.random() * 100, stability: 0.85 + Math.random() * 0.1 }
            };

            modelComparisonChart.data.datasets[0].data = [
                modelData.PPO.reward,
                modelData.A3C.reward,
                modelData.SAC.reward,
                modelData.DQN.reward
            ];

            modelComparisonChart.data.datasets[1].data = [
                modelData.PPO.stability,
                modelData.A3C.stability,
                modelData.SAC.stability,
                modelData.DQN.stability
            ];

            modelComparisonChart.update();
        }

        // Update trading frequency display
        document.getElementById('tradingFreq').addEventListener('input', function() {
            document.getElementById('freqValue').textContent = parseFloat(this.value).toFixed(2);
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            loadTokenomicsData();

            // Add event listeners for controls
            document.getElementById('simulationMode').addEventListener('change', loadTokenomicsData);
            document.getElementById('riskPreference').addEventListener('change', loadTokenomicsData);
            document.getElementById('marketCondition').addEventListener('change', loadTokenomicsData);
        });
    </script>
</body>
</html>